<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ماشین‌حساب سود و زیان پرواربندی</title>

  <style>
    body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
            direction: rtl;
            text-align: right;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 25px;
        }
        .form-section {
            background-color: #eafaea; /* سبز خیلی روشن برای تفکیک بخش ها */
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 25px;
            border: 1px solid #d4edda;
        }
        .form-section h3 {
            color: #28a745;
            margin-top: 0;
            margin-bottom: 15px;
            text-align: right;
            border-bottom: 1px dashed #a3e2b2;
            padding-bottom: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"],
        select {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        /* کلاس جدید برای فیلدهای متنی که فرمت عددی می‌شوند */
        input.currency-input {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
            /* اطمینان از راست به چپ بودن متن در داخل فیلد */
            text-align: left;
            direction: ltr;
        }
        button {
            background-color: #6f42c1; /* بنفش برای دکمه اصلی */
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
            margin-top: 20px;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #5a359c;
        }
        .results, .suggestions {
            margin-top: 30px;
            padding: 20px;
            background-color: #fff3cd; /* زرد روشن */
            border: 1px solid #ffeeba;
            border-radius: 5px;
        }
        .results p, .suggestions p, .suggestions ul {
            margin-bottom: 10px;
            line-height: 1.6;
            text-align: justify;
        }
        .results strong {
            color: #856404; /* زرد تیره */
        }
        .suggestions strong {
            color: #28a745; /* سبز */
        }
        .note {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            text-align: justify;
        }
        .profit {
            color: #28a745; /* سبز برای سود */
            font-weight: bold;
            font-size: 1.2em;
        }
        .loss {
            color: #dc3545; /* قرمز برای زیان */
            font-weight: bold;
            font-size: 1.2em;
        }
  </style>

  
</head>
<body>
  <div class="container">
        <h1>ماشین‌حساب سود و زیان پرواربندی</h1>

        <form id="profitLossCalculatorForm">
            <div class="form-section">
                <h3>الف) اطلاعات پروژه پرواربندی</h3>
                <div class="form-group">
                    <label for="projectName">نام پروژه/دوره پرواربندی:</label>
                    <input type="text" id="projectName" name="projectName" placeholder="مثال: پرواربندی گوساله، دوره بهار">
                </div>
                <div class="form-group">
                    <label for="animalType">نوع دام:</label>
                    <select id="animalType" name="animalType" required>
                        <option value="">انتخاب کنید...</option>
                        <option value="beef_cattle">گاو گوشتی</option>
                        <option value="dairy_calf">گوساله شیری (پرواربندی)</option>
                        <option value="sheep_lamb">گوسفند/بره</option>
                        <option value="other">سایر</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="numAnimals">تعداد رأس دام:</label>
                    <input type="text" id="numAnimals" name="numAnimals" class="currency-input" placeholder="مثال: 50" required>
                </div>
                <div class="form-group">
                    <label for="initialWeight">میانگین وزن اولیه هر رأس (کیلوگرم):</label>
                    <input type="text" id="initialWeight" name="initialWeight" class="currency-input" step="0.1" placeholder="مثال: 250" required>
                </div>
                <div class="form-group">
                    <label for="targetWeight">میانگین وزن هدف هر رأس (کیلوگرم):</label>
                    <input type="text" id="targetWeight" name="targetWeight" class="currency-input" step="0.1" placeholder="مثال: 500" required>
                </div>
                <div class="form-group">
                    <label for="fatteningDays">مدت زمان پرواربندی (روز):</label>
                    <input type="text" id="fatteningDays" name="fatteningDays" class="currency-input" placeholder="مثال: 180" required>
                </div>
                <div class="form-group">
                    <label for="expectedMortalityRate">درصد تلفات مورد انتظار (%):</label>
                    <input type="text" id="expectedMortalityRate" name="expectedMortalityRate" class="currency-input" step="0.1" placeholder="مثال: 2 (دو درصد)">
                    <p class="note">این درصد برای محاسبه تعداد دام قابل فروش نهایی استفاده می‌شود.</p>
                </div>
            </div>

            <div class="form-section">
                <h3>ب) هزینه‌ها</h3>
                <div class="form-group">
                    <label for="purchasePricePerAnimal">قیمت خرید هر رأس دام در شروع پرواربندی (ریال/تومان):</label>
                    <input type="text" id="purchasePricePerAnimal" name="purchasePricePerAnimal" class="currency-input" placeholder="مثال: 25,000,000" required>
                </div>
                <div class="form-group">
                    <label for="feedCostTotal">هزینه کل خوراک برای کل دوره (ریال/تومان):</label>
                    <input type="text" id="feedCostTotal" name="feedCostTotal" class="currency-input" placeholder="مثال: 100,000,000">
                    <p class="note">این مقدار را می‌توانید از **ماشین‌حساب هزینه خوراک** (قبلی) به دست آورید.</p>
                </div>
                <div class="form-group">
                    <label for="vetMedicineCost">هزینه بهداشت و درمان (دامپزشک، دارو، واکسن) برای کل دوره (ریال/تومان):</label>
                    <input type="text" id="vetMedicineCost" name="vetMedicineCost" class="currency-input" placeholder="مثال: 2,000,000">
                </div>
                <div class="form-group">
                    <label for="laborCost">هزینه نیروی انسانی برای کل دوره (ریال/تومان):</label>
                    <input type="text" id="laborCost" name="laborCost" class="currency-input" placeholder="مثال: 5,000,000">
                </div>
                <div class="form-group">
                    <label for="energyWaterCost">هزینه انرژی و آب برای کل دوره (ریال/تومان):</label>
                    <input type="text" id="energyWaterCost" name="energyWaterCost" class="currency-input" placeholder="مثال: 1,500,000">
                </div>
                <div class="form-group">
                    <label for="rentDepreciationCost">اجاره/استهلاک تجهیزات و ساختمان برای کل دوره (ریال/تومان):</label>
                    <input type="text" id="rentDepreciationCost" name="rentDepreciationCost" class="currency-input" placeholder="مثال: 3,000,000">
                    <p class="note">اینها جزو هزینه‌های ثابت محسوب می‌شوند.</p>
                </div>
                <div class="form-group">
                    <label for="otherCosts">سایر هزینه‌های متفرقه برای کل دوره (ریال/تومان):</label>
                    <input type="text" id="otherCosts" name="otherCosts" class="currency-input" placeholder="مثال: 1,000,000">
                </div>
            </div>

            <div class="form-section">
                <h3>ج) درآمدها</h3>
                <div class="form-group">
                    <label for="sellingPricePerKg">قیمت فروش مورد انتظار هر کیلوگرم دام زنده (ریال/تومان):</label>
                    <input type="text" id="sellingPricePerKg" name="sellingPricePerKg" class="currency-input" placeholder="مثال: 120,000" required>
                </div>
            </div>

            <button type="submit">محاسبه سود و زیان پرواربندی</button>
        </form>

        <div class="results" id="profitLossResults">
            <h2>نتایج برآورد اقتصادی</h2>
            <p><strong>نام پروژه:</strong> <span id="displayProjectName">--</span></p>
            <p><strong>تعداد دام قابل فروش:</strong> <span id="salableAnimals">--</span> رأس</p>
            <p><strong>کل افزایش وزن تولید شده:</strong> <span id="totalWeightProduced">--</span> کیلوگرم</p>
            <p><strong>کل هزینه‌های پروژه:</strong> <span id="totalProjectCosts">--</span> ریال/تومان</p>
            <p><strong>کل درآمد پیش‌بینی شده:</strong> <span id="totalRevenue">--</span> ریال/تومان</p>
            <p><strong>سود/زیان خالص:</strong> <span id="netProfitLoss">--</span></p>
            <p><strong>نقطه سربه‌سر (کیلوگرم تولید):</strong> <span id="breakEvenKg">--</span> کیلوگرم</p>
            <p><strong>نقطه سربه‌سر (تعداد رأس):</strong> <span id="breakEvenAnimals">--</span> رأس</p>
            <p class="note">توجه: این نتایج تخمینی هستند و باید با دقت و بر اساس داده‌های واقعی مزرعه شما به‌روزرسانی شوند. نوسانات بازار، بیماری‌ها و عوامل پیش‌بینی نشده می‌توانند بر سودآوری تأثیر بگذارند.</p>
        </div>

        <div class="suggestions" id="financialSuggestions">
            <h2>توضیحات و پیشنهادات مالی</h2>
            <h3>مفاهیم کلیدی:</h3>
            <ul>
                <li><strong>هزینه‌های ثابت:</strong> هزینه‌هایی که مستقل از حجم تولید هستند و باید پرداخت شوند (مانند اجاره، استهلاک).</li>
                <li><strong>هزینه‌های متغیر:</strong> هزینه‌هایی که مستقیماً با حجم تولید تغییر می‌کنند (مانند خوراک، خرید دام، دارو).</li>
                <li><strong>نقطه سربه‌سر:</strong> حداقل تولید (کیلوگرم یا تعداد رأس) که در آن کل درآمدها برابر با کل هزینه‌هاست و نه سود و نه زیانی حاصل می‌شود.</li>
                <li><strong>سود خالص:</strong> درآمد کل منهای کل هزینه‌ها.</li>
            </ul>

            <h3>پیشنهادات برای بهبود سودآوری در پرواربندی:</h3>
            <ul>
                <li><strong>مدیریت تغذیه:</strong> بهینه‌سازی جیره غذایی برای دستیابی به حداکثر رشد با حداقل خوراک (بهبود FCR). خوراک معمولاً بزرگترین سهم هزینه را دارد.</li>
                <li><strong>کاهش تلفات:</strong> برنامه‌های جامع بهداشتی، واکسیناسیون به موقع، و مدیریت استرس برای کاهش مرگ و میر و افزایش تعداد دام قابل فروش.</li>
                <li><strong>انتخاب نژاد:</strong> انتخاب نژادهایی که پتانسیل رشد بالا، FCR مناسب و مقاومت به بیماری‌ها را دارند.</li>
                <li><strong>بازار یابی مؤثر:</strong> شناسایی بهترین زمان و کانال‌های فروش برای دستیابی به بالاترین قیمت ممکن.</li>
                <li><strong>پایش مداوم:</strong> ثبت دقیق هزینه‌ها و درآمدها، وزن‌کشی منظم و مقایسه با برآوردها برای شناسایی نقاط ضعف و قوت.</li>
                <li><strong>کنترل هزینه‌های جانبی:</strong> مدیریت بهینه مصرف آب و انرژی، و کنترل هزینه‌های کارگری.</li>
                <li><strong>مقیاس اقتصادی:</strong> در نظر گرفتن افزایش مقیاس عملیات در صورت امکان، برای بهره‌مندی از تخفیفات خرید عمده و کاهش هزینه‌های ثابت به ازای هر رأس.</li>
            </ul>

            <p class="note">این پیشنهادات کلی هستند. برای تصمیم‌گیری‌های مالی موفق، مطالعه دقیق بازار، مشورت با متخصصان دامپروری و مالی، و پایش دقیق داده‌های مزرعه شما حیاتی است.</p>
        </div>
    </div>

  <script>
    // تابع کمکی برای حذف جداکننده‌ها و تبدیل به عدد
        function cleanAndParseNumber(value) {
            const cleanedValue = String(value).replace(/[^0-9.]/g, '');
            return parseFloat(cleanedValue || '0');
        }

        // تابع کمکی برای فرمت‌دهی عدد با جداکننده هزارگان
        function formatNumberWithCommas(number, decimalPlaces = 0) {
            if (isNaN(number)) return '';
            return parseFloat(number.toFixed(decimalPlaces)).toLocaleString('fa-IR');
        }

        // اعمال فرمت‌دهی به فیلدهای ورودی (نمایش سه تا سه تا)
        document.addEventListener('DOMContentLoaded', function() {
            const currencyInputs = document.querySelectorAll('.currency-input');

            currencyInputs.forEach(input => {
                input.addEventListener('input', function() {
                    let value = this.value;
                    const cleanedValue = value.replace(/[^0-9.]/g, ''); 
                    
                    if (value.endsWith('.') && cleanedValue.endsWith('.')) {
                        this.value = cleanedValue;
                        return;
                    }

                    let number = parseFloat(cleanedValue);
                    if (!isNaN(number)) {
                        if (cleanedValue.includes('.')) {
                            const parts = cleanedValue.split('.');
                            const integerPart = parseFloat(parts[0]);
                            this.value = formatNumberWithCommas(integerPart) + '.' + parts[1];
                        } else {
                            this.value = formatNumberWithCommas(number);
                        }
                    } else {
                        this.value = ''; 
                    }
                });

                input.addEventListener('blur', function() {
                    let value = this.value;
                    const cleanedValue = value.replace(/[^0-9.]/g, '');
                    let number = parseFloat(cleanedValue);
                    if (!isNaN(number) && cleanedValue !== '') {
                        let decimalPlaces = 0;
                        if (input.id === 'initialWeight' || input.id === 'targetWeight' || input.id === 'expectedMortalityRate') {
                            decimalPlaces = 2; // برای وزن‌ها و درصد اعشار لازم است
                        }
                        this.value = formatNumberWithCommas(number, decimalPlaces);
                    } else if (cleanedValue === '') {
                        this.value = '';
                    }
                });

                input.addEventListener('focus', function() {
                    let value = this.value;
                    this.value = value.replace(/[^0-9.]/g, ''); 
                });
            });
        });

        // منطق محاسبه اصلی سود و زیان
        document.getElementById('profitLossCalculatorForm').addEventListener('submit', function(event) {
            event.preventDefault();

            // گرفتن مقادیر ورودی با استفاده از تابع cleanAndParseNumber
            const projectName = document.getElementById('projectName').value || 'پروژه نامشخص';
            const animalType = document.getElementById('animalType').value;
            const numAnimals = cleanAndParseNumber(document.getElementById('numAnimals').value);
            const initialWeight = cleanAndParseNumber(document.getElementById('initialWeight').value);
            const targetWeight = cleanAndParseNumber(document.getElementById('targetWeight').value);
            const fatteningDays = cleanAndParseNumber(document.getElementById('fatteningDays').value);
            const expectedMortalityRate = cleanAndParseNumber(document.getElementById('expectedMortalityRate').value);

            const purchasePricePerAnimal = cleanAndParseNumber(document.getElementById('purchasePricePerAnimal').value);
            const feedCostTotal = cleanAndParseNumber(document.getElementById('feedCostTotal').value);
            const vetMedicineCost = cleanAndParseNumber(document.getElementById('vetMedicineCost').value);
            const laborCost = cleanAndParseNumber(document.getElementById('laborCost').value);
            const energyWaterCost = cleanAndParseNumber(document.getElementById('energyWaterCost').value);
            const rentDepreciationCost = cleanAndParseNumber(document.getElementById('rentDepreciationCost').value);
            const otherCosts = cleanAndParseNumber(document.getElementById('otherCosts').value);

            const sellingPricePerKg = cleanAndParseNumber(document.getElementById('sellingPricePerKg').value);

            // اعتبارسنجی اولیه
            if (numAnimals <= 0 || initialWeight <= 0 || targetWeight <= initialWeight || fatteningDays <= 0 || sellingPricePerKg <= 0) {
                alert('لطفاً همه فیلدهای ضروری را با مقادیر معتبر (بزرگتر از صفر) پر کنید و اطمینان حاصل کنید که وزن هدف از وزن اولیه بیشتر است.');
                return;
            }

            // --- محاسبات ---
            // 1. تعداد دام قابل فروش
            const actualNumAnimalsSold = numAnimals * (1 - (expectedMortalityRate / 100));
            
            // 2. کل افزایش وزن تولید شده
            const weightGainPerAnimal = targetWeight - initialWeight;
            const totalWeightProduced = weightGainPerAnimal * actualNumAnimalsSold; // افزایش وزن از دام‌های زنده باقی‌مانده

            // 3. کل هزینه‌های پروژه (خرید دام + متغیر + ثابت)
            const totalPurchaseCost = numAnimals * purchasePricePerAnimal; // هزینه خرید دام اولیه برای کل گله
            const totalProjectCosts = totalPurchaseCost + feedCostTotal + vetMedicineCost + laborCost + energyWaterCost + rentDepreciationCost + otherCosts;

            // 4. کل درآمد پیش‌بینی شده
            const totalRevenue = totalWeightProduced * sellingPricePerKg;

            // 5. سود/زیان خالص
            const netProfitLoss = totalRevenue - totalProjectCosts;

            // 6. نقطه سربه‌سر (Break-Even Point)
            // هزینه متغیر واحد = (هزینه خوراک + بهداشت + کارگر + انرژی + سایر) / تعداد دام * میانگین افزایش وزن (تقریبی)
            // این محاسبه برای نقطه سربه‌سر کمی پیچیده است و نیاز به تفکیک دقیق‌تر هزینه‌های متغیر و ثابت دارد.
            // به طور ساده، نقطه سربه‌سر کیلوگرم: کل هزینه‌های ثابت / (قیمت فروش هر کیلوگرم - (کل هزینه‌های متغیر / کل افزایش وزن تولیدی))
            // در اینجا هزینه‌های خرید دام و بخشی از خوراک و ... متغیرند.
            
            // برای سادگی، یک نقطه سربه‌سر کلی بر اساس هزینه کل به ازای هر کیلوگرم افزایش وزن و قیمت فروش.
            // این یک برآورد ساده‌شده است و نیازمند تحلیل دقیق‌تر است
            let breakEvenKg = 'نیاز به تحلیل عمیق‌تر';
            let breakEvenAnimals = 'نیاز به تحلیل عمیق‌تر';

            // یک محاسبه ساده‌شده برای نقطه سربه‌سر بر اساس کل هزینه‌ها و متوسط قیمت هر کیلوگرم افزایش وزن:
            const averageCostPerKgProduced = totalProjectCosts / totalWeightProduced;
            if (sellingPricePerKg > averageCostPerKgProduced) {
                // این فقط یک تخمین ساده است و مفروضات زیادی دارد
                // این بر مبنای اینکه تمام دام ها با میانگین وزن هدف فروخته شوند
                breakEvenKg = (totalProjectCosts / sellingPricePerKg).toFixed(2);
                breakEvenAnimals = (totalProjectCosts / (sellingPricePerKg * weightGainPerAnimal + purchasePricePerAnimal)).toFixed(2);
            } else {
                breakEvenKg = 'فروش با زیان (قیمت فروش کمتر از میانگین هزینه هر کیلوگرم تولید)';
                breakEvenAnimals = 'فروش با زیان';
            }
            
            // --- نمایش نتایج با فرمت دهی سه تا سه تا ---
            document.getElementById('displayProjectName').textContent = projectName;
            document.getElementById('salableAnimals').textContent = formatNumberWithCommas(actualNumAnimalsSold, 2);
            document.getElementById('totalWeightProduced').textContent = formatNumberWithCommas(totalWeightProduced, 2);
            document.getElementById('totalProjectCosts').textContent = formatNumberWithCommas(totalProjectCosts);
            document.getElementById('totalRevenue').textContent = formatNumberWithCommas(totalRevenue);
            
            const netProfitLossElement = document.getElementById('netProfitLoss');
            if (netProfitLoss > 0) {
                netProfitLossElement.className = 'profit';
                netProfitLossElement.textContent = 'سود: ' + formatNumberWithCommas(netProfitLoss) + ' ریال/تومان';
            } else if (netProfitLoss < 0) {
                netProfitLossElement.className = 'loss';
                netProfitLossElement.textContent = 'زیان: ' + formatNumberWithCommas(Math.abs(netProfitLoss)) + ' ریال/تومان';
            } else {
                netProfitLossElement.className = ''; 
                netProfitLossElement.textContent = 'نقطه سربه‌سر (سود/زیان صفر): ' + formatNumberWithCommas(netProfitLoss) + ' ریال/تومان';
            }

            document.getElementById('breakEvenKg').textContent = breakEvenKg;
            document.getElementById('breakEvenAnimals').textContent = breakEvenAnimals;
        });
  </script>
</body>
</html>
